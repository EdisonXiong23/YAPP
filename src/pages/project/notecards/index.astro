---
import ProjectLayout from '../../../layouts/ProjectLayout.astro';
import { get_user_session, app } from '../../../firebase/server';
import Card from '../../../components/Card.astro';
import type { Props } from 'astro/components/ViewTransitions.astro';
import { getFirestore } from 'firebase-admin/firestore';
import type Notecard from '../../../lib/notecard.ts';

const user = await get_user_session(Astro.cookies);
if(!user) {
  return Astro.redirect("/signin");
}

interface DatabaseNotecard {
  primary_id : string;
  notecard : Notecard;
}

const db = getFirestore(app);
const notecards_ref = db.collection("Notecards");
const notecards_snapshot = await notecards_ref.where("student_id", "==", user.uid).get();
const user_notecards : DatabaseNotecard[] = notecards_snapshot.docs.map((doc) => ({
  primary_id: doc.id,
  notecard: doc.data(),
})) as DatabaseNotecard[];


---

<ProjectLayout title="Notecards">
  <div id = "Page">
    <div class = "notecards-grid">
        {
          user_notecards.map((notecard : DatabaseNotecard) => (
            <div>
                <Card
                    start_page={notecard.notecard.start_page} 
                    end_page={notecard.notecard.end_page} 
                    title = {notecard.notecard.title}  
                    quote = {notecard.notecard.quote} 
                    href = {`/notecards/${notecard.primary_id}`}
                />
            </div> 
          ))
        }
    </div>
  </div>
</ProjectLayout>

<style>
    #Page {
        position: absolute;
        right: 0;
        margin-top: 1rem;
        width: calc(100vw - 1rem - 5vw);
        max-width: calc(100vw - 1rem - 12vw);
        text-align: center;
        align-items: center;
    }
    
    .add-notecard {
      display: flex;
		  max-height: 18vh;
		  height: 18vh;
		  padding: 1px;
		  background-color: var(--color-surface-mixed-300);
		  background-image: none;
		  background-size: 400%;
	    border-radius: 7px;
		  background-position: 100%;
		  transition: background-position 0.6s cubic-bezier(0.22, 1, 0.36, 1);
		  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
		  overflow: hidden;
    }


    .notecards-grid {
      width: 90%;
      position: relative;
      left: 5%;
      display: grid;
      grid-template-columns: auto auto auto;
      
    }

    td {
      padding: 0.5rem;
      width: 25%;
    }
</style>